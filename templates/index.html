<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <title>Document</title>
    <style>


    </style>
</head>
<body>
    <div class="container my-5 body-header">
        <h1 class="mb-4">Upload A/Many PDF File(s)</h1>
    </div>
    <div class="container body-content">
        
        <div class="mb-3">

            <div id="container-upload" class="mb-3">
                <label for="pdfFiles" class="form-label">Select PDF File(s):</label>
                <input class="form-control" type="file" id="pdfFiles" accept="application/pdf" multiple>
                

                <!-- Here will be the list of uploaded files  -->
                <div id="uploadedFilesList" class="mt-3">
                    <ul id="fileList" class="form-text">
                    </ul>
                </div>
                <button id="uploadBtn" class="btn btn-primary mt-3">Upload</button>
            </div>

            <div id="container-fileFeatures" class="form-text">

            </div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script>

        let uploadedFiles = {};
        document.getElementById('pdfFiles').addEventListener('change', function(event) {
            const input = event.target;
            const files = input.files;
            const filelist = document.getElementById('fileList');

            filelist.innerHTML = '';

            Array.from(files).forEach(element => { 
                
                const div = document.createElement('div');
                div.classList.add('form-text');
                div.classList.add('mt-2');
                
                const li = document.createElement('li');
                li.textContent = element.name;

                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'Delete';
                deleteBtn.classList.add('btn', 'btn-sm', 'btn-danger', 'ms-2');
                deleteBtn.addEventListener('click', function() {
                    div.remove();
                    const dt = new DataTransfer();
                    Array.from(input.files)
                        .filter(file => file.name !== element.name)
                        .forEach(file => dt.items.add(file));
                    input.files = dt.files;
                });
                deleteBtn.style.marginLeft = '10px';
                deleteBtn.style.fontSize = '0.8em';
                deleteBtn.style.color = 'white';

                div.appendChild(li);
                div.appendChild(deleteBtn);
                filelist.appendChild(div);

            });
        });

        document.getElementById('uploadBtn').addEventListener('click', function() {
            const input = document.getElementById('pdfFiles');
            const files = input.files;

            if (files.length === 0) {
                alert('Please select at least one PDF file.');
                return;
            }

            Array.from(files).forEach(element => {
                console.log(element.name);
            });

            fetch('/upload',{
                method: 'POST'
            })
            .then(response => {
                if(response.ok || response.status === 200) {
                    uploadedFiles = response.json();
                } else {
                    throw new Error('Upload failed');
                }
            })
            .then(()=>{
                console.log("Uploaded Files:")
                console.log(uploadedFiles);
            });

        });
    
    </script>
</body>
</html>